

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>S3 Asset Server &mdash; Specify Developer Documentation  documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Specify Cloud Graviton Setup" href="specify_cloud_graviton_setup.html" />
    <link rel="prev" title="&lt;no title&gt;" href="rds_backup_setup.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Specify Developer Documentation
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Guidelines:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../processes/github_guidelines.html"><strong>GitHub Guidelines and Process</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="../processes/support_guidelines.html">Support Staff Expectations &amp; Best Practices</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Launching a Release:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../processes/create_release_notes.html">Create Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../processes/release_process_for_hosted_users.html">Release Process for Hosted Users</a></li>
<li class="toctree-l1"><a class="reference internal" href="../processes/support_guidelines.html">Support Staff Expectations &amp; Best Practices</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Amazon Web Services:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="add_new_instance_to_specify_cloud.html">Add new instance to Specify Cloud</a></li>
<li class="toctree-l1"><a class="reference internal" href="asset_server_setup.html">Asset Server Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="authentication.html">Authentication</a></li>
<li class="toctree-l1"><a class="reference internal" href="automation_todo.html">Automation TODO</a></li>
<li class="toctree-l1"><a class="reference internal" href="aws_cloud_setup.html">AWS Cloud Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="connect_to_remote_cloud_database.html">Connect to remote cloud database</a></li>
<li class="toctree-l1"><a class="reference internal" href="data_size_check_commands.html">Data Size Check Commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="deploy_specify7_to_EC2.html">Deploy Specify7 to EC2</a></li>
<li class="toctree-l1"><a class="reference internal" href="infrastructure_notes.html">Infrastructure Notes</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">S3 Asset Server</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#here-are-the-s3-buckets-for-each-of-the-asset-regions">Here are the S3 Buckets for each of the Asset Regions:</a></li>
<li class="toctree-l2"><a class="reference internal" href="#backup-locations">Backup Locations:</a></li>
<li class="toctree-l2"><a class="reference internal" href="#aws-s3-sync-commands-for-backup-cronjobs">AWS S3 Sync Commands for Backup Cronjobs:</a></li>
<li class="toctree-l2"><a class="reference internal" href="#user-s3-buckets">User S3 Buckets:</a></li>
<li class="toctree-l2"><a class="reference internal" href="#user-asset-uploading-without-a-user-s3-bucket">User Asset Uploading Without a User S3 Bucket:</a></li>
<li class="toctree-l2"><a class="reference internal" href="#s3-attachments">S3 Attachments</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="specify_cloud_graviton_setup.html">Specify Cloud Graviton Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="web_portal_with_docker.html">Web Portal with Docker</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Asset Server:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../asset_server/asset_config_files.html">Specify 7 Docker Config Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="../asset_server/asset_server_config.html">Asset Server Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../asset_server/asset_server_setup.html">EC2 Non-Dockerized Build</a></li>
<li class="toctree-l1"><a class="reference internal" href="../asset_server/hybrid_asset_server_setup.html">Hybrid Asset Server Setup</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Server Management:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../server_management/managed_servers.html">Updown Monitoring</a></li>
<li class="toctree-l1"><a class="reference internal" href="../server_management/managed_servers.html#managed-servers">Managed Servers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../server_management/managed_servers.html#accessing-specify-7-deployments">Accessing Specify 7 Deployments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../server_management/managed_servers.html#accessing-backups-on-aws-rds">Accessing Backups on AWS RDS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../server_management/specify_ssh_docker_guide.html">Specify Test Panel User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../server_management/add_user_to_EC2.html">Server Access Management Policy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../server_management/check_asset_usage.html">Check Asset Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../server_management/exoscale.html">Exoscale Hosted Instances</a></li>
<li class="toctree-l1"><a class="reference internal" href="../server_management/exoscale_backups.html">Backups on Exoscale</a></li>
<li class="toctree-l1"><a class="reference internal" href="../server_management/kuit_ssl_certs.html">New certificate on biprdsp7wbdb.cc.ku.edu server</a></li>
<li class="toctree-l1"><a class="reference internal" href="../server_management/kuit_ssl_certs.html#web-portal-certificate">web-portal certificate</a></li>
<li class="toctree-l1"><a class="reference internal" href="../server_management/kuit_ssl_certs.html#specify-ku-edu-ssl-cert-update">specify.ku.edu ssl cert update</a></li>
<li class="toctree-l1"><a class="reference internal" href="../server_management/reports.html">Hosting Reports</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Internal Processes:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../dev_process/specify_processes.html">Specify Development Process</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev_process/project_docs.html">Project (Github pages) documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev_process/dbgroups.html">Databases with Specific Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev_process/individualdbs.html">Individual Database Information</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev_process/dev_expectations.html">Developer Expectations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev_process/developeronboarding.html">Developer Onboarding – Specify Software</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev_process/dev_support_process.html">Dev Support Process</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev_process/release_process_timeline.html">Release Process and Timeline</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Security:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../security/aws_security.html">AWS Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../security/fix_exposed_secret.html">Fix Exposed Secrets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../security/monitoring.html">Security Monitoring</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Testing:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../testing/pull_requests.html">Pull Request Testing</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Specify Software:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../software_desc/glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../software_desc/overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../software_desc/membership.html">Membership</a></li>
<li class="toctree-l1"><a class="reference internal" href="../software_desc/disciplines.html">Discipline support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../software_desc/hosting.html">Specify Cloud Hosting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../software_desc/migration.html">Data Migration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../software_desc/training.html">Specify Training</a></li>
<li class="toctree-l1"><a class="reference internal" href="../software_desc/workbench.html">Specify Workbench</a></li>
<li class="toctree-l1"><a class="reference internal" href="../software_desc/workflows.html">Common Workflows</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer Utils:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../developer_utils/writing_migrations.html">Writing Migrations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer_utils/setting_up_backend_debugger.html">Setting Up Backend Debugger in VS Code for Specify 7</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer_utils/Install_Specify7.html">Installing Specify 7 Locally</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Technical Decisions:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../technical_decisions/component_extension.html">Component Extension to Collection Objects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../technical_decisions/batch_edit.html">Batch Edit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../technical_decisions/cog.html">Collection Object Groups (COG) Design &amp; Implementation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../technical_decisions/extended_age_query.html">Extended Age Query (EAQ) Design &amp; Implementation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Misc:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../misc/remove_specify_cloud_instance.html">Removing a Specify Cloud Instance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/documentation.html">Informatics Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/kuit_notes.html">Working with central KU IT</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/specify7_ecs_most-in-one.html">Create a Most-In-One Specify Docker image</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/useful_bash_cmds.html">Useful bash commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/vs_code_django_unit_test_debugging_notes.html">VS Code Django Unit Test Debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/branch_from_tag.html">Create a branch from a tagged release</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">History:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../history/digital_ocean_to_aws_migration.html">Digital Ocean to AWS migration</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Specify Developer Documentation</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">S3 Asset Server</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/aws/s3_asset_server.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="s3-asset-server">
<h1>S3 Asset Server<a class="headerlink" href="#s3-asset-server" title="Link to this heading"></a></h1>
<section id="here-are-the-s3-buckets-for-each-of-the-asset-regions">
<h2>Here are the S3 Buckets for each of the Asset Regions:<a class="headerlink" href="#here-are-the-s3-buckets-for-each-of-the-asset-regions" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>us: s3://sp-assets-us/</p></li>
<li><p>ca: s3://sp-assets-ca/</p></li>
<li><p>eu: s3://sp-assets-eu/</p></li>
<li><p>il: s3://sp-assets-il/</p></li>
<li><p>br: s3://sp-assets-br/</p></li>
</ul>
</section>
<section id="backup-locations">
<h2>Backup Locations:<a class="headerlink" href="#backup-locations" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>us: s3://sp-assets-na-snaphots/</p></li>
<li><p>ca: s3://sp-assets-ca-snaphot/</p></li>
<li><p>eu: s3://sp-assets-eu-snaphot/</p></li>
<li><p>il: s3://sp-assets-il-snaphot/</p></li>
<li><p>br: s3://specify-cloud-rds-backups-br/asset-backups/</p></li>
</ul>
</section>
<section id="aws-s3-sync-commands-for-backup-cronjobs">
<h2>AWS S3 Sync Commands for Backup Cronjobs:<a class="headerlink" href="#aws-s3-sync-commands-for-backup-cronjobs" title="Link to this heading"></a></h2>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>aws<span class="w"> </span>s3<span class="w"> </span>sync<span class="w"> </span>s3://sp-assets-us<span class="w"> </span>s3://sp-assets-na-snapshots<span class="w"> </span>--size-only<span class="w"> </span>--only-show-errors<span class="p">;</span>
aws<span class="w"> </span>s3<span class="w"> </span>sync<span class="w"> </span>s3://sp-assets-ca<span class="w"> </span>s3://sp-assets-ca-snapshot<span class="w"> </span>--size-only<span class="w"> </span>--only-show-errors<span class="p">;</span>
aws<span class="w"> </span>s3<span class="w"> </span>sync<span class="w"> </span>s3://sp-assets-eu<span class="w"> </span>s3://sp-assets-eu-snapshot<span class="w"> </span>--size-only<span class="w"> </span>--only-show-errors<span class="p">;</span>
aws<span class="w"> </span>s3<span class="w"> </span>sync<span class="w"> </span>s3://sp-assets-il<span class="w"> </span>s3://specify-cloud-rds-backups-il/asset-backups<span class="w"> </span>--size-only<span class="w"> </span>--only-show-errors<span class="p">;</span>
aws<span class="w"> </span>s3<span class="w"> </span>sync<span class="w"> </span>s3://sp-assets-br<span class="w"> </span>s3://specify-cloud-rds-backups-br/asset-backups<span class="w"> </span>--size-only<span class="w"> </span>--only-show-errors<span class="p">;</span>
</pre></div>
</div>
</section>
<section id="user-s3-buckets">
<h2>User S3 Buckets:<a class="headerlink" href="#user-s3-buckets" title="Link to this heading"></a></h2>
<p>The user needs to have an AWS account, then create and upload data to their S3 bucket.</p>
<p>Give the user the follow bucket policy to give Specify and the asset server access to the user’s S3 bucket.</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;Version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2012-10-17&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;Statement&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;Sid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AllowExternalAccountAccess&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;Principal&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;AWS&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;arn:aws:iam::321942852011:user/specify.dev&quot;</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="s2">&quot;s3:GetObject&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;s3:PutObject&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;s3:DeleteObject&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;s3:ListBucket&quot;</span>
<span class="w">      </span><span class="p">],</span>
<span class="w">      </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="s2">&quot;arn:aws:s3:::&lt;BucketName&gt;&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;arn:aws:s3:::&lt;BucketName&gt;/*&quot;</span>
<span class="w">      </span><span class="p">]</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This gives the specify developer AWS user access to the user’s S3 bucket, so that the asset server can user the data.  The user can just give access to particular path in their S# bucket if they want.  We also need to make sure that the path they tell us to use is formatted correctly, with an originals and thumbnails directory with the correct file types in each.  The last thing to do is to add the S3 path for the client in the settings.py file in the server.</p>
</section>
<section id="user-asset-uploading-without-a-user-s3-bucket">
<h2>User Asset Uploading Without a User S3 Bucket:<a class="headerlink" href="#user-asset-uploading-without-a-user-s3-bucket" title="Link to this heading"></a></h2>
<p>If the wants to upload assets directly to the asset server, then uploading over ssh is used.  First an linux user is setup for the client with their ssh keys added.  Second, a s3fs mount is created for that user.  The s3fs mount is mounted as “attachments” in the user’s home directory.  The mount will point to the path to the user’s folder in S3.  This is so that the user can only access the S3 path in the bucket that is associated with that user.</p>
<p>If a user wants regular backups available to them, a cronjob can be setup to do daily backups, which the user can fetch over ssh via a command like ‘scp’, ‘sftp’, or ‘rsync’.  A command like this can be used in a cronjob to create a tarball:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="m">0</span><span class="w"> </span><span class="m">3</span><span class="w"> </span>*<span class="w"> </span>*<span class="w"> </span><span class="m">0</span><span class="w"> </span>tar<span class="w"> </span>-cJf<span class="w"> </span>/home/user/user-assets.tar.xz<span class="w"> </span>-C<span class="w"> </span>/home/ubuntu/attachments<span class="w"> </span>user<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>chown<span class="w"> </span>user:user<span class="w"> </span>/home/user/user-assets.tar.xz
</pre></div>
</div>
</section>
<section id="s3-attachments">
<h2>S3 Attachments<a class="headerlink" href="#s3-attachments" title="Link to this heading"></a></h2>
<p>The current asset server is configured to use the AWS S3 API commands to add, get, and delete assets located in S3.  This reduces storage cost compared to EFS, and is faster to run compared to s3fs.  Future development should be to make this universal, so to work on both a local file system, and on S3, and let each client define the setup in the settings file.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="rds_backup_setup.html" class="btn btn-neutral float-left" title="&lt;no title&gt;" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="specify_cloud_graviton_setup.html" class="btn btn-neutral float-right" title="Specify Cloud Graviton Setup" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Specify Collections Consortium Team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>